syntax = "proto3";

package core;

option go_package = "github.com/CrabStash/crab-stash-protofiles/core/proto";
import "google/protobuf/empty.proto";

// enums 

enum Types {
  TYPE_STRING = 0;
  TYPE_INTEGER = 1;
  TYPE_DATE = 2;
  TYPE_DATETIME = 3;
}

// basic definitions

message Field {
  string title = 1;
  Types type = 2;
  string help = 3;
}

message Category {
  string title = 1;
  string description = 2;
  string type = 3;
  map<string, Field> properties = 4;
}


// Services

message Schema {
  bytes file_content = 1;
}

message CoreMiddlewareRequest {
  string target = 1;
  string warehouseID = 2;
}

message CoreMiddlewareResponse {
  bool doesItBelong = 1;
}

message InheritanceRequest {
  string categoryID = 1;
  string warehouseID = 2;
}

message InheritanceResponse {
  message Parent {
    repeated string fieldNames = 1;
    string id = 2;
    string name = 3; //@gotags: json:"title"
  }

  message Response {
    repeated Parent parents = 1;
  }

  int32 status = 1;
  //@gotags: json:"response"
  oneof response {
    //@gotags: json:"data"
    Response data = 2;
    string error = 3; 
  }
}

message ServeCategoryRequest {
  string categoryID = 1;
  string warehouseID = 2;
}

message ServeCategoryResponse {
  message Response {
    Category schema = 1;
  }

  int32 status = 1;
  //@gotags: json:"response"
  oneof response {
    //@gotags: json:"data"
    Response data = 2;
    string error = 3; 
  }
}

// service
service CoreService {
  rpc ServeCategorySchema (google.protobuf.Empty) returns (Schema);
  rpc ServeFieldSchema (google.protobuf.Empty) returns (Schema);
}